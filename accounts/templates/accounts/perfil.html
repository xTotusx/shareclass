{% extends 'accounts/base.html' %}

{% load static %}

{% block content %}
<div class="profile-box">
  <h1>Perfil de {{ user.username }}</h1>
  <div class="profile-info">
    <p><strong>Nombre de usuario:</strong> {{ user.username }}</p>
    <p><strong>Correo:</strong> {{ user.email }}</p>
  </div>

  <!-- Avatar actual -->
  <div class="selected-avatar" id="selectedAvatar">
    {% if profile_image %}
      <img id="selectedAvatarImg" src="{% static 'accounts/' %}{{ profile_image }}" alt="Avatar seleccionado">
    {% else %}
      <img id="selectedAvatarImg" src="{% static 'accounts/avatar_pp1.jpeg' %}" alt="Avatar por defecto">
    {% endif %}
  </div>

  <!-- Formulario de selecci칩n -->
  <form method="post" action="{% url 'perfil' %}">
    {% csrf_token %}
    <div class="profile-avatars">
      <h3>Elige tu avatar</h3>
      <div class="avatars">
        {% for i in "123456789" %}
          <label>
            <input type="radio" name="profile_image" value="avatar_pp{{ i }}.jpeg" {% if profile_image == "avatar_pp"|add:i|add:".jpeg" %}checked{% endif %}>
            <img src="{% static 'accounts/avatar_pp' %}{{ i }}.jpeg" class="avatar" alt="avatar {{ i }}">
          </label>
        {% endfor %}
      </div>

      <button type="submit" class="save-btn">Guardar</button>
    </div>
  </form>

  <div class="profile-options" style="margin-top:1.5rem;">
    <a href="#">Cambiar contrase침a</a>
    <a href="{% url 'logout' %}">Cerrar sesi칩n</a>
  </div>
</div>

<script>
  // Selecci칩n de avatar
  document.querySelectorAll('.avatars label img').forEach(img => {
    img.addEventListener('click', () => {
      const input = img.parentElement.querySelector('input[type="radio"]');
      if (input) input.checked = true;

      document.querySelectorAll('.avatar').forEach(a => a.classList.remove('selected'));
      img.classList.add('selected');

      const preview = document.getElementById('selectedAvatarImg');
      if (preview) preview.src = img.src;
    });
  });

  window.addEventListener('DOMContentLoaded', () => {
    const checked = document.querySelector('.avatars input[type="radio"]:checked');
    if (checked) {
      const img = checked.parentElement.querySelector('img');
      if (img) {
        img.classList.add('selected');
        const preview = document.getElementById('selectedAvatarImg');
        if (preview) preview.src = img.src;
      }
    }
  });
</script>
{% endblock %}

